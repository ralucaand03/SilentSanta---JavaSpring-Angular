<div class="page">
    <div class="requests-container">
      <!-- Header -->
      <div class="requests-header">
        <h1 class="page-title">My Letter Requests</h1>
        <p class="page-description">Track the status of letters you've requested to fulfill.</p>
      </div>
      
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Loading your requests...</p>
      </div>
      
      <!-- Error Message -->
      <div class="error-message" *ngIf="errorMessage">
        <p>{{ errorMessage }}</p>
      </div>
      
      <!-- Success Message -->
      <div class="success-message" *ngIf="successMessage">
        <p>{{ successMessage }}</p>
      </div>
      
      <!-- Tabs -->
      <div class="requests-tabs">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'outgoing'"
          (click)="setActiveTab('outgoing')">
          My Requests
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'incoming'"
          (click)="setActiveTab('incoming')">
          Requests for My Letters
        </button>
      </div>
      
      <!-- Outgoing Requests (My Requests) -->
      <div class="requests-list" *ngIf="activeTab === 'outgoing'">
        <div class="requests-empty" *ngIf="userRequests.length === 0 && !isLoading">
          <div class="empty-state">
            <i class="icon-mail-large"></i>
            <h3>No letter requests</h3>
            <p>You haven't requested any letters yet.</p>
            <button class="primary-button" routerLink="/letters">Browse Letters</button>
          </div>
        </div>
        
        <div class="request-card" *ngFor="let request of userRequests">
          <div class="request-header">
            <div class="request-header-content">
              <h2 class="child-name">{{ request.letter?.childName }}, {{ request.letter?.childAge }}</h2>
              <div class="request-badges">
                <span class="gender-badge" [class]="request.letter?.gender">
                  <i [class]="'icon-' + request.letter?.gender"></i>
                </span>
                <span class="location-badge">{{ request.letter?.location }}</span>
                <span class="status-badge" [class]="request.status.toLowerCase()">
                  {{ request.status }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="request-content">
            <h3 class="wishes-title">Christmas Wishes:</h3>
            <ul class="wishes-list">
              <li *ngFor="let item of request.letter?.wishList">{{ item }}</li>
            </ul>
          </div>
          
          <div class="request-footer">
            <button 
              class="cancel-button" 
              *ngIf="request.status === 'WAITING'"
              (click)="cancelRequest(request)">
              Cancel Request
            </button>
            <div class="status-message" [class]="request.status.toLowerCase()">
              <ng-container [ngSwitch]="request.status">
                <span *ngSwitchCase="'WAITING'">Your request is pending approval</span>
                <span *ngSwitchCase="'ACCEPTED'">Your request has been accepted!</span>
                <span *ngSwitchCase="'DENIED'">Your request has been denied</span>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Incoming Requests (Requests for My Letters) -->
      <div class="requests-list" *ngIf="activeTab === 'incoming'">
        <div class="requests-empty" *ngIf="letterOwnerRequests.length === 0 && !isLoading">
          <div class="empty-state">
            <i class="icon-mail-large"></i>
            <h3>No incoming requests</h3>
            <p>You don't have any requests for your letters yet.</p>
          </div>
        </div>
        
        <div class="request-card" *ngFor="let request of letterOwnerRequests">
          <div class="request-header">
            <div class="request-header-content">
              <h2 class="child-name">{{ request.letter?.childName }}, {{ request.letter?.childAge }}</h2>
              <div class="request-badges">
                <span class="gender-badge" [class]="request.letter?.gender">
                  <i [class]="'icon-' + request.letter?.gender"></i>
                </span>
                <span class="location-badge">{{ request.letter?.location }}</span>
                <span class="status-badge" [class]="request.status.toLowerCase()">
                  {{ request.status }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="request-content">
            <h3 class="requester-info">Requested by:</h3>
            <p class="requester-name">{{ request.user?.firstName }} {{ request.user?.lastName }}</p>
            <p class="requester-email">{{ request.user?.email }}</p>
          </div>
          
          <div class="request-footer">
            <div class="action-buttons" *ngIf="request.status === 'WAITING'">
              <button 
                class="accept-button" 
                (click)="updateRequestStatus(request, 'ACCEPTED')">
                Accept
              </button>
              <button 
                class="deny-button" 
                (click)="updateRequestStatus(request, 'DENIED')">
                Deny
              </button>
            </div>
            <div class="status-message" [class]="request.status.toLowerCase()">
              <ng-container [ngSwitch]="request.status">
                <span *ngSwitchCase="'WAITING'">This request is waiting for your response</span>
                <span *ngSwitchCase="'ACCEPTED'">You've accepted this request</span>
                <span *ngSwitchCase="'DENIED'">You've denied this request</span>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  